{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/survey.service\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction SurveysComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"p\");\n    i0.ɵɵtext(2, \"Loading surveys...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction SurveysComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵtext(1, \" No surveys available at the moment. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SurveysComponent_div_4_div_1_div_6_input_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"input\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function SurveysComponent_div_4_div_1_div_6_input_4_Template_input_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r13);\n      const i_r8 = i0.ɵɵnextContext().index;\n      const survey_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.responses[survey_r4._id][i_r8] = $event);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r8 = i0.ɵɵnextContext().index;\n    const survey_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r9.responses[survey_r4._id][i_r8])(\"name\", \"q\" + i_r8);\n  }\n}\nfunction SurveysComponent_div_4_div_1_div_6_select_5_option_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const option_r19 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", option_r19);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(option_r19);\n  }\n}\nfunction SurveysComponent_div_4_div_1_div_6_select_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"select\", 20);\n    i0.ɵɵlistener(\"ngModelChange\", function SurveysComponent_div_4_div_1_div_6_select_5_Template_select_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const i_r8 = i0.ɵɵnextContext().index;\n      const survey_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r20 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r20.responses[survey_r4._id][i_r8] = $event);\n    });\n    i0.ɵɵelementStart(1, \"option\", 21);\n    i0.ɵɵtext(2, \"-- Select an option --\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, SurveysComponent_div_4_div_1_div_6_select_5_option_3_Template, 2, 2, \"option\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r25 = i0.ɵɵnextContext();\n    const i_r8 = ctx_r25.index;\n    const question_r7 = ctx_r25.$implicit;\n    const survey_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r10.responses[survey_r4._id][i_r8])(\"name\", \"q\" + i_r8);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", question_r7.options);\n  }\n}\nconst _c0 = function (a0, a1) {\n  return {\n    \"btn-primary\": a0,\n    \"btn-outline-primary\": a1\n  };\n};\nfunction SurveysComponent_div_4_div_1_div_6_div_6_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r29 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function SurveysComponent_div_4_div_1_div_6_div_6_button_1_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r29);\n      const n_r27 = restoredCtx.$implicit;\n      const i_r8 = i0.ɵɵnextContext(2).index;\n      const survey_r4 = i0.ɵɵnextContext().$implicit;\n      const ctx_r28 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r28.responses[survey_r4._id][i_r8] = n_r27);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const n_r27 = ctx.$implicit;\n    const i_r8 = i0.ɵɵnextContext(2).index;\n    const survey_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r26 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(2, _c0, ctx_r26.responses[survey_r4._id][i_r8] == n_r27, ctx_r26.responses[survey_r4._id][i_r8] != n_r27));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", n_r27, \" \");\n  }\n}\nconst _c1 = function () {\n  return [1, 2, 3, 4, 5];\n};\nfunction SurveysComponent_div_4_div_1_div_6_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtemplate(1, SurveysComponent_div_4_div_1_div_6_div_6_button_1_Template, 2, 5, \"button\", 25);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(1, _c1));\n  }\n}\nfunction SurveysComponent_div_4_div_1_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"label\", 14);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 15);\n    i0.ɵɵtemplate(4, SurveysComponent_div_4_div_1_div_6_input_4_Template, 1, 2, \"input\", 16);\n    i0.ɵɵtemplate(5, SurveysComponent_div_4_div_1_div_6_select_5_Template, 4, 3, \"select\", 17);\n    i0.ɵɵtemplate(6, SurveysComponent_div_4_div_1_div_6_div_6_Template, 2, 2, \"div\", 18);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const question_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(question_r7.prompt);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitch\", question_r7.type);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"text\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"choice\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngSwitchCase\", \"rating\");\n  }\n}\nconst _c2 = function (a0, a1) {\n  return {\n    \"alert-success\": a0,\n    \"alert-danger\": a1\n  };\n};\nfunction SurveysComponent_div_4_div_1_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const survey_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(2, _c2, ctx_r6.success[survey_r4._id], !ctx_r6.success[survey_r4._id]));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r6.messages[survey_r4._id], \" \");\n  }\n}\nfunction SurveysComponent_div_4_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r36 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7)(2, \"h5\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 8)(5, \"form\", 9);\n    i0.ɵɵlistener(\"ngSubmit\", function SurveysComponent_div_4_div_1_Template_form_ngSubmit_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r36);\n      const survey_r4 = restoredCtx.$implicit;\n      const ctx_r35 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r35.submitResponse(survey_r4));\n    });\n    i0.ɵɵtemplate(6, SurveysComponent_div_4_div_1_div_6_Template, 7, 5, \"div\", 10);\n    i0.ɵɵelementStart(7, \"button\", 11);\n    i0.ɵɵtext(8, \"Submit Response\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, SurveysComponent_div_4_div_1_div_9_Template, 2, 5, \"div\", 12);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const survey_r4 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(survey_r4.title);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", survey_r4.questions);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.messages[survey_r4._id]);\n  }\n}\nfunction SurveysComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, SurveysComponent_div_4_div_1_Template, 10, 3, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.surveys);\n  }\n}\nexport class SurveysComponent {\n  constructor(surveyService, authService) {\n    this.surveyService = surveyService;\n    this.authService = authService;\n    this.surveys = [];\n    this.loading = true;\n    this.responses = {};\n    this.messages = {};\n    this.success = {};\n  }\n  ngOnInit() {\n    this.loadSurveys();\n  }\n  loadSurveys() {\n    this.surveyService.getSurveys().subscribe({\n      next: data => {\n        this.surveys = data;\n        this.loading = false;\n        // Initialize responses for each survey\n        this.surveys.forEach(survey => {\n          this.responses[survey._id] = new Array(survey.questions.length);\n        });\n      },\n      error: err => {\n        console.error('Failed to load surveys', err);\n        this.loading = false;\n      }\n    });\n  }\n  submitResponse(survey) {\n    const answers = this.responses[survey._id].map((answer, index) => ({\n      questionIndex: index,\n      answer\n    })).filter(a => a.answer !== undefined && a.answer !== null && a.answer !== '');\n    if (answers.length !== survey.questions.length) {\n      this.messages[survey._id] = 'Please answer all questions';\n      this.success[survey._id] = false;\n      return;\n    }\n    const response = {\n      answers,\n      userEmail: this.authService.getUserEmail()\n    };\n    this.surveyService.submitSurveyResponse(survey._id, response).subscribe({\n      next: () => {\n        this.messages[survey._id] = 'Response submitted successfully!';\n        this.success[survey._id] = true;\n        this.responses[survey._id] = new Array(survey.questions.length);\n      },\n      error: err => {\n        this.messages[survey._id] = err.error?.error || 'Failed to submit response';\n        this.success[survey._id] = false;\n      }\n    });\n  }\n  static {\n    this.ɵfac = function SurveysComponent_Factory(t) {\n      return new (t || SurveysComponent)(i0.ɵɵdirectiveInject(i1.SurveyService), i0.ɵɵdirectiveInject(i2.AuthService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: SurveysComponent,\n      selectors: [[\"app-surveys\"]],\n      decls: 5,\n      vars: 3,\n      consts: [[\"class\", \"text-center\", 4, \"ngIf\"], [\"class\", \"alert alert-info\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"text-center\"], [1, \"alert\", \"alert-info\"], [\"class\", \"card mb-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"card\", \"mb-4\"], [1, \"card-header\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"class\", \"mb-3\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [\"class\", \"alert mt-3\", 3, \"ngClass\", 4, \"ngIf\"], [1, \"mb-3\"], [1, \"form-label\"], [3, \"ngSwitch\"], [\"type\", \"text\", \"class\", \"form-control\", 3, \"ngModel\", \"name\", \"ngModelChange\", 4, \"ngSwitchCase\"], [\"class\", \"form-select\", 3, \"ngModel\", \"name\", \"ngModelChange\", 4, \"ngSwitchCase\"], [\"class\", \"btn-group\", \"role\", \"group\", 4, \"ngSwitchCase\"], [\"type\", \"text\", 1, \"form-control\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [1, \"form-select\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"role\", \"group\", 1, \"btn-group\"], [\"type\", \"button\", \"class\", \"btn\", 3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn\", 3, \"ngClass\", \"click\"], [1, \"alert\", \"mt-3\", 3, \"ngClass\"]],\n      template: function SurveysComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"h2\");\n          i0.ɵɵtext(1, \"Surveys\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(2, SurveysComponent_div_2_Template, 3, 0, \"div\", 0);\n          i0.ɵɵtemplate(3, SurveysComponent_div_3_Template, 2, 0, \"div\", 1);\n          i0.ɵɵtemplate(4, SurveysComponent_div_4_Template, 2, 1, \"div\", 2);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.surveys.length === 0);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.surveys.length > 0);\n        }\n      },\n      dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i3.NgSwitch, i3.NgSwitchCase, i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.NgModel, i4.NgForm],\n      encapsulation: 2\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["i0","SurveysComponent","constructor","surveyService","authService","ngOnInit","loadSurveys","getSurveys","subscribe","next","data","surveys","loading","forEach","survey","responses","_id","Array","questions","length","error","err","console","submitResponse","answers","map","answer","index","questionIndex","filter","a","undefined","messages","success","response","userEmail","getUserEmail","submitSurveyResponse","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\Jadala Yashwanth Sai\\OneDrive\\Desktop\\Final\\mean-citizen-voice\\angular-client\\src\\app\\components\\surveys\\surveys.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { SurveyService } from '../../services/survey.service';\nimport { AuthService } from '../../services/auth.service';\n\n@Component({\n  selector: 'app-surveys',\n  template: `\n    <h2>Surveys</h2>\n    <div *ngIf=\"loading\" class=\"text-center\">\n      <p>Loading surveys...</p>\n    </div>\n    <div *ngIf=\"!loading && surveys.length === 0\" class=\"alert alert-info\">\n      No surveys available at the moment.\n    </div>\n    <div *ngIf=\"!loading && surveys.length > 0\">\n      <div *ngFor=\"let survey of surveys\" class=\"card mb-4\">\n        <div class=\"card-header\">\n          <h5>{{survey.title}}</h5>\n        </div>\n        <div class=\"card-body\">\n          <form (ngSubmit)=\"submitResponse(survey)\">\n            <div *ngFor=\"let question of survey.questions; let i = index\" class=\"mb-3\">\n              <label class=\"form-label\">{{question.prompt}}</label>\n              \n              <div [ngSwitch]=\"question.type\">\n                <input *ngSwitchCase=\"'text'\" type=\"text\" class=\"form-control\" \n                  [(ngModel)]=\"responses[survey._id][i]\" [name]=\"'q'+i\">\n                \n                <select *ngSwitchCase=\"'choice'\" class=\"form-select\" \n                  [(ngModel)]=\"responses[survey._id][i]\" [name]=\"'q'+i\">\n                  <option value=\"\">-- Select an option --</option>\n                  <option *ngFor=\"let option of question.options\" [value]=\"option\">{{option}}</option>\n                </select>\n                \n                <div *ngSwitchCase=\"'rating'\" class=\"btn-group\" role=\"group\">\n                  <button *ngFor=\"let n of [1,2,3,4,5]\" type=\"button\" class=\"btn\"\n                    [ngClass]=\"{'btn-primary': responses[survey._id][i] == n, 'btn-outline-primary': responses[survey._id][i] != n}\"\n                    (click)=\"responses[survey._id][i] = n\">\n                    {{n}}\n                  </button>\n                </div>\n              </div>\n            </div>\n            \n            <button type=\"submit\" class=\"btn btn-primary\">Submit Response</button>\n            \n            <div *ngIf=\"messages[survey._id]\" class=\"alert mt-3\"\n              [ngClass]=\"{'alert-success': success[survey._id], 'alert-danger': !success[survey._id]}\">\n              {{messages[survey._id]}}\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  `\n})\nexport class SurveysComponent implements OnInit {\n  surveys: any[] = [];\n  loading = true;\n  responses: {[key: string]: any[]} = {};\n  messages: {[key: string]: string} = {};\n  success: {[key: string]: boolean} = {};\n  \n  constructor(\n    private surveyService: SurveyService,\n    private authService: AuthService\n  ) {}\n  \n  ngOnInit(): void {\n    this.loadSurveys();\n  }\n  \n  loadSurveys(): void {\n    this.surveyService.getSurveys().subscribe({\n      next: (data) => {\n        this.surveys = data;\n        this.loading = false;\n        \n        // Initialize responses for each survey\n        this.surveys.forEach(survey => {\n          this.responses[survey._id] = new Array(survey.questions.length);\n        });\n      },\n      error: (err) => {\n        console.error('Failed to load surveys', err);\n        this.loading = false;\n      }\n    });\n  }\n  \n  submitResponse(survey: any): void {\n    const answers = this.responses[survey._id].map((answer, index) => ({\n      questionIndex: index,\n      answer\n    })).filter(a => a.answer !== undefined && a.answer !== null && a.answer !== '');\n    \n    if (answers.length !== survey.questions.length) {\n      this.messages[survey._id] = 'Please answer all questions';\n      this.success[survey._id] = false;\n      return;\n    }\n    \n    const response = {\n      answers,\n      userEmail: this.authService.getUserEmail()\n    };\n    \n    this.surveyService.submitSurveyResponse(survey._id, response).subscribe({\n      next: () => {\n        this.messages[survey._id] = 'Response submitted successfully!';\n        this.success[survey._id] = true;\n        this.responses[survey._id] = new Array(survey.questions.length);\n      },\n      error: (err) => {\n        this.messages[survey._id] = err.error?.error || 'Failed to submit response';\n        this.success[survey._id] = false;\n      }\n    });\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}